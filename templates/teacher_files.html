<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>My Folders & Files</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>
  <h1>ðŸ‘‹ Hello, {{ session['teacher_name'] }} </h1>
  {% with messages = get_flashed_messages() %}
    {% if messages %}<div class="flash">{{ messages[0] }}</div>{% endif %}
  {% endwith %}

  <section>
    <h2>Folders</h2>
    <form method="POST" action="{{ url_for('folder_create') }}" class="inline">
      <input name="name" placeholder="New folder name" required />
      <button type="submit">Create Folder</button>
    </form>

    {% if folders %}
      <table>
        <tr><th>Name</th><th>Created</th><th>Rename</th><th>Delete</th></tr>
        {% for f in folders %}
        <tr>
          <td>{{ f['name'] }}</td>
          <td>{{ f['created_at'] }}</td>
          <td>
            <form method="POST" action="{{ url_for('folder_rename', folder_id=f['id']) }}">
              <input name="name" placeholder="New name" required />
              <button type="submit">Rename</button>
            </form>
          </td>
          <td><a href="{{ url_for('folder_delete', folder_id=f['id']) }}" onclick="return confirm('Delete folder? Make sure it is empty.');">Delete</a></td>
        </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>No folders yet.</p>
    {% endif %}
  </section>

  <section>
    <h2>My Files</h2>
    <p><a class="btn" href="{{ url_for('upload') }}">Upload a New File</a></p>
    {% if files %}
    <table>
      <tr><th>File</th><th>Subject</th><th>Folder</th><th>Uploaded</th><th>Actions</th></tr>
      {% for f in files %}
      <tr>
        <td>{{ f['file_name'] }}</td>
        <td>{{ f['subject'] or '-' }}</td>
        <td>{{ f['folder_name'] or '-' }}</td>
        <td>{{ f['upload_date'] }}</td>
        <td>
          <a href="{{ url_for('download_file', filename=f['file_path']) }}">Download</a> |
          <a href="{{ url_for('file_delete', file_id=f['id']) }}" onclick="return confirm('Delete this file?');">Delete</a>
        </td>
      </tr>
      {% endfor %}
    </table>
    {% else %}
      <p>No files uploaded yet.</p>
    {% endif %}
  </section>

  <p><a href="{{ url_for('logout') }}">Logout</a></p>
</body>
</html>
